coord_flip()
Age.males.ed
pdf(file="Outcomes//Age_ed_decomp_Males.pdf",width=8,height=10,pointsize=6,useDingbats = F)
print(Age.males.ed)
dev.off()
mydata <- Data[Data$sex == 'Female' & Data$Ind == 'ed' & Data$Age5 != '0-4' &
Data$Age5 != '105-109' & Data$Age5 != '110+',]
Age.females.ed <-ggplot() +
ggtitle( 'Age-contribution to changes in life disparity by period' , subtitle = expression(paste('Females, negative values decrease ',e^"\u2020", 'and positive values increase ',e^"\u2020")))+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + country,nrow =4,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = Age5, y = Contribution, fill = color,group = Period), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$Period), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),legend.position="bottom")+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
Age.females.ed
pdf(file="Outcomes//Age_ed_decomp_Females.pdf",width=13,height=10,pointsize=6,useDingbats = F)
print(Age.females.ed)
dev.off()
#### Infant contributions
Infant.e0 <- ggplot(Data[Data$Ind == 'e0' & Data$Age5 == '0-4',],
aes(x = country, y = Contribution, fill = Period, width=.7)) +
ggtitle( 'Infant contribution to changes in life expectancy by period')+
scale_fill_manual('Period', values = myColours1) +
geom_bar(aes(group = Period), stat = "identity",position = "stack")+
facet_wrap(~sex)+
labs(x = "Country", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5,
linetype="solid"),
axis.title = element_text(),
rect = element_rect(fill = 'white',
linetype = 0, colour = NA))+
theme(axis.title.y = element_text(size = 12, angle = 90))+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 14))+
geom_hline(yintercept = 0)+
coord_flip()
Infant.e0
pdf(file="Outcomes//Infant_ex_decomp.pdf",width=12,height=7,pointsize=6,useDingbats = F)
print(Infant.e0)
dev.off()
Infant.ed <- ggplot(Data[Data$Ind == 'ed' & Data$Age5 == '0-4',],
aes(x = country, y = Contribution, fill = Period, width=.7)) +
ggtitle( 'Infant contribution to changes in life disparity by period')+
scale_fill_manual('Period', values = myColours1) +
geom_bar(aes(group = Period), stat = "identity",position = "stack")+
facet_wrap(~sex)+
labs(x = "Country", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5,
linetype="solid"),
axis.title = element_text(),
rect = element_rect(fill = 'white',
linetype = 0, colour = NA))+
theme(axis.title.y = element_text(size = 12, angle = 90))+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 14))+
geom_hline(yintercept = 0)+
coord_flip()
Infant.e0
pdf(file="Outcomes//Infant_ed_decomp.pdf",width=12,height=7,pointsize=6,useDingbats = F)
print(Infant.ed)
dev.off()
library(ggthemes)
library(reshape2)
library(ggplot2)
library(data.table)
library(RColorBrewer)
###########################################################################
setwd(  "C:/Users/jmaburto/Documents/GitHub/Lifespan-variation-in-Eastern-Europe")
load("Data/Decomp_Causes_EE.RData")
source("R/Functions.R")
################# To group by 5 years age-intervals
#set ages as 0,5,10,...85
Data              <- data.table(CoD.Results)
Data$contribution <- Data$value
Data              <- Data[,c('Country','sex','year','cause','age','ind','contribution')]
unique(Data$year)
#Group into 2 periods
Data$period      <- 1
Data[Data$year >= 2000,]$period      <- 2
Data$period      <- as.factor(Data$period)
levels(Data$period) <- c('1994-2000', '2000-2010')
Data <- Data[, list(contribution = sum(contribution)), by = list(Country,sex,cause,age,ind,period)]
#1) Wholy attributable to alcohol
#2) IHD
#3) Stroke
#4) Transportation accidents
#5) Other external causes
#6) Infectious and respiratory diseases
#7) Cancers
#8) Other Circulatory
#9) birth conditions
#10) Rest of causes
### Add labels to periods
base2 <- toupper(c("#7265e7", "#e265e7", "#e7657d", "#e7bc65", "#a2e765", "#65e797", "#65c7e7"))
#plot(1:7,1:7,col=toupper(base2),pch=16,cex=5)
# determine order by eyeballing colors to causes (HT J. Schoeley)
myColours1 <- c(base2[c(3,4,5,1,7,2,6)], 'lightskyblue4','pink','lightgrey')
Data$cause <- factor(Data$cause, levels=rev(levels(Data$cause)))
levels(Data$cause)
cause.males.e01 <- ggplot(Data[Data$sex == 'Male' & Data$ind == 'ex' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',],
aes(x = age, y = contribution, fill = cause, width=.7)) +
ggtitle( 'Age-contribution to changes in life expectancy by cause of death' , subtitle = 'Males, 1994-2000')+
scale_fill_manual('Cause', values = rev(myColours1)) +
guides(fill = guide_legend(reverse = TRUE))+
geom_bar(aes(group = cause), stat = "identity",position = "stack")+
facet_wrap(~Country)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5,
linetype="solid"),
axis.title = element_text(),
rect = element_rect(fill = 'white',
linetype = 0, colour = NA))+
theme(axis.title.y = element_text(size = 12, angle = 90))+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 8))+
geom_hline(yintercept = 0)+
coord_flip()
cause.males.e01
cause.males.ed1 <- ggplot(Data[Data$sex == 'Male' & Data$ind == 'ed' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',],
aes(x = age, y = contribution, fill = cause, width=.7)) +
ggtitle( 'Age-contribution to changes in life disparity by cause of death' , subtitle = 'Males, 1994-2000')+
scale_fill_manual('Cause of death', values = rev(myColours1)) +
geom_bar(aes(group = cause), stat = "identity",position = "stack")+
facet_wrap(~Country)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5,
linetype="solid"),
axis.title = element_text(),
rect = element_rect(fill = 'white',
linetype = 0, colour = NA))+
theme(axis.title.y = element_text(size = 12, angle = 90))+
theme(axis.title.x = element_text(size = 12, angle = 00))+
theme(text = element_text(size=14),
strip.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 8))+
geom_hline(yintercept = 0)+
theme(legend.position = c(0.85, 0.15))+
guides(fill=guide_legend(ncol=1,reverse = TRUE,title.position = "top" ))+
coord_flip()
cause.males.ed1
pdf(file="Outcomes//Cause_ed_decomp_Males_1.pdf",width=11,height=10,pointsize=6,useDingbats = F)
print(cause.males.ed1)
dev.off()
library(ggthemes)
library(reshape2)
library(ggplot2)
library(data.table)
library(RColorBrewer)
library(plotly)
library(grid)
###########################################################################
setwd(  "C:/Users/jmaburto/Documents/GitHub/Lifespan-variation-in-Eastern-Europe-2017")
load("Data/Decomp_Causes_EE.RData")
source("R/Functions.R")
################# To group by 5 years age-intervals
#set ages as 0,5,10,...85
Data              <- data.table(CoD.Results)
Data$contribution <- Data$value
Data              <- Data[,c('Country','sex','year','cause','age','ind','contribution')]
unique(Data$year)
#Group into 2 periods
Data$period      <- 1
Data[Data$year >= 2000,]$period      <- 2
Data$period      <- as.factor(Data$period)
levels(Data$period) <- c('1994-2000', '2000-2010')
Data$cause2 <- as.character(Data$cause)
levels(Data$cause)
Data[Data$cause2 == "Stroke" | Data$cause2 == "IHD" | Data$cause2 == "Other Circulatory",]$cause2 <- 'Circulatory'
Data[Data$cause2 == "Birth conditions" ,]$cause2 <- 'Rest'
unique(Data$cause2)
Data <- Data[, list(contribution = sum(contribution)), by = list(Country,sex,cause2,age,ind,period)]
fake <- Data[Data$Country == 'Poland',]
fake$Country <- 'Zfake'
fake$contribution <- 0
Data <- rbind(Data,fake)
#1) Wholy attributable to alcohol
#2) Circulatory
#3) Transportation accidents
#4) Other external causes
#5) Infectious and respiratory diseases
#6) Cancers
#7) Rest of causes
### Add labels to periods
base2 <- toupper(c("#7265e7", "#e265e7", "#e7657d", "#e7bc65", "#a2e765", "#65e797", "#65c7e7"))
#plot(1:7,1:7,col=toupper(base2),pch=16,cex=5)
# determine order by eyeballing colors to causes (HT J. Schoeley)
myColours1 <- c(base2[c(3,4,5,1,7,2)],'lightgrey')
Data$cause <- as.factor(Data$cause2)
levels(Data$cause)
Data$cause <- factor(Data$cause, levels(Data$cause)[rev(c(1,3,5,7,4,2,6))])
levels(Data$cause)
CEE <- sort(c('Bulgaria','Czhech Republic','Hungary','Poland','Slovakia','Slovenia', 'fake'))
BC  <- sort(c('Estonia','Latvia','Lithuania'))
FSU <- sort(c('Belarus','Russia','Ukraine'))
Data$Region <- 1
Data[Data$Country %in% BC,]$Region <-2
Data[Data$Country %in% FSU,]$Region <-3
Data$Region <- as.factor(Data$Region)
levels(Data$Region) <- c('CE','BC','FSU')
myColours2 <- c('gray','royalblue3','orangered')
mysubset <- unique(Data[,c('Country','Region')])
mysubset$color <- myColours2[1]
mysubset[mysubset$Region == 'FSU']$color <- myColours2[2]
mysubset[mysubset$Region == 'BC']$color <- myColours2[3]
Data$color <- myColours1[1]
Data[Data$cause == unique(Data$cause)[2]]$color <- myColours1[2]
Data[Data$cause == unique(Data$cause)[3]]$color <- myColours1[3]
Data[Data$cause == unique(Data$cause)[4]]$color <- myColours1[4]
Data[Data$cause == unique(Data$cause)[5]]$color <- myColours1[5]
Data[Data$cause == unique(Data$cause)[6]]$color <- myColours1[6]
Data[Data$cause == unique(Data$cause)[7]]$color <- myColours1[7]
mydata <-Data[Data$sex == 'Male' & Data$ind == 'ex' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',]
Age.males.e01 <- ggplot() +
ggtitle( 'Age-contribution to changes in life expectancy by cause of death' , subtitle = 'Males, 1994-2000')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(Age.males.e01)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_e0_decomp_Males_1.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <- Data[Data$sex == 'Male' & Data$ind == 'ex' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '2000-2010',]
cause.males.e02 <- ggplot() +
ggtitle( 'Age-contribution to changes in life expectancy by cause of death' , subtitle = 'Males, 2000-2010')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.males.e02)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_e0_decomp_Males_2.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <-Data[Data$sex == 'Female' & Data$ind == 'ex' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',]
cause.females.e01 <- ggplot() +
ggtitle( 'Age-contribution to changes in life expectancy by cause of death' , subtitle = 'Females, 1994-2000')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.females.e01)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_e0_decomp_Females_1.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <- Data[Data$sex == 'Female' & Data$ind == 'ex' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '2000-2010',]
cause.females.e02 <- ggplot() +
ggtitle( 'Age-contribution to changes in life expectancy by cause of death' , subtitle = 'Females, 2000-2010')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.females.e02)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_e0_decomp_Females_2.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
############################################################################
mydata <- Data[Data$sex == 'Male' & Data$ind == 'ed' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',]
cause.males.ed1 <- ggplot() +
ggtitle( 'Age-contribution to changes in life disparity by cause of death' , subtitle = 'Males, 1994-2000')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.males.ed1)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_ed_decomp_Males_1.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <- Data[Data$sex == 'Male' & Data$ind == 'ed' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '2000-2010',]
cause.males.ed2 <- ggplot() +
ggtitle( 'Age-contribution to changes in life disparity by cause of death' , subtitle = 'Males, 2000-2010')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.males.ed2)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_ed_decomp_Males_2.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <-Data[Data$sex == 'Female' & Data$ind == 'ed' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '1994-2000',]
cause.females.ed1 <- ggplot() +
ggtitle( 'Age-contribution to changes in life disparity by cause of death' , subtitle = 'Females, 1994-2000')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.females.ed1)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_ed_decomp_Females_1.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
mydata <-Data[Data$sex == 'Female' & Data$ind == 'ed' & Data$age != '1-4' & Data$age != '0' &
Data$age != '105-109' & Data$age != '110+' & Data$period == '2000-2010',]
cause.females.ed2 <- ggplot() +
ggtitle( 'Age-contribution to changes in life disparity by cause of death' , subtitle = 'Females, 2000-2010')+
geom_rect(data = mysubset, aes(fill=color),xmin =-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha = 0.1)+
facet_wrap(~Region + Country,nrow =3,labeller = label_wrap_gen(multi_line=FALSE))+
geom_bar(data = mydata, aes(x = age, y = contribution, fill = color,group = cause), stat = "identity",position = "stack")+
scale_fill_identity('Period',guide = 'legend', labels = unique(mydata$cause), breaks = myColours1)+
labs(x = "Age group", y = "Contribution (years)",size=12)+
theme_fivethirtyeight(base_size = 18)+
theme(panel.border = element_rect(fill=NA,color="black", size=0.5, linetype="solid"),
axis.title = element_text(),rect = element_rect(fill = 'white', linetype = 0, colour = NA),
axis.title.y = element_text(size = 12, angle = 90),
axis.title.x = element_text(size = 12, angle = 00),
title =element_text(size=10, face='bold'),
text = element_text(size=14),strip.text.x = element_text(size = 12, colour = "black"),
axis.text.y = element_text(size = 8),
legend.position = c(0.84, 0.85))+
guides(fill=guide_legend(ncol=1),size = guide_legend(title.position="top", title.hjust = 0.5))+
geom_hline(yintercept = 0)+
coord_flip()
g = ggplotGrob(cause.females.ed2)
g$layout
pos <- grepl(pattern = "panel-1-3", g$layout$name)
g$grobs <- g$grobs[!pos]
g$layout <- g$layout[!pos, ]
grid.newpage()
grid.draw(g)
pdf(file="Outcomes//Cause_ed_decomp_Females_2.pdf",width=10,height=10,pointsize=6,useDingbats = F)
grid.draw(g)
dev.off()
library(data.table)
library(reshape2)
library(latticeExtra)
library(ggplot2)
library(ggthemes)
setwd(  "C:/Users/jmaburto/Documents/GitHub/Lifespan-variation-in-Eastern-Europe")
load("Data/HMD_Data.RData")
source("R/Functions.R")
Eastern_HMDL             <- HMDL[HMDL$PopName %in% Country.HMD.vec & HMDL$Year >= 1960,]
Eastern_HMDL$Country     <- Country.name.vec[Eastern_HMDL$PopName]
Eastern_HMDL$Sex         <- as.factor(Eastern_HMDL$Sex)
levels(Eastern_HMDL$Sex) <- Sexes
# Life expectancy trends --------------------------------------------------
ex.m <- ggplot(Eastern_HMDL[Eastern_HMDL$Age == 0 & Eastern_HMDL$Sex=='Male'], aes(Year, ex,colour=Country)) +
ggtitle( expression(paste('Life expectancy (',e[0],')')) , subtitle = 'Males')+
annotate('rect', xmin=1987, xmax=1989, ymin=-Inf, ymax=Inf,
alpha=0.2,fill="red")+
geom_line(aes(group = Country,size= Country),show.legend = F) +
scale_size_manual(values =lwd.fig.F1b,guide = FALSE)+
scale_x_continuous('Year', expand = c(0, 0)) +
scale_y_continuous('Years', limits = c(55,80)) +
theme_fivethirtyeight(base_size = 18)+
geom_vline(aes(xintercept=1991.8),show.legend = F,linetype=2,lwd=1.5, colour="blue")+
scale_colour_manual('Country', values = col.fig.F1b) +
theme(text = element_text(size=18),legend.key.size = unit(.4, "in"),axis.title = element_text(),
rect = element_rect(fill = 'white',
linetype = 0, colour = NA),
legend.position="bottom")
ex.m
